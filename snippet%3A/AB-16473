const productGrid = document.querySelector('product-grid')
const productCards = document.querySelectorAll('cdx-card.card.ng-star-inserted');

productCards.forEach(card=>{
    const strapLine = card.querySelector('.productStrap-text');
    const priceWas = card.querySelector('.price--was');
    const priceSave = card.querySelector('.price--save');
    const fullPrice = priceWas && priceWas.textContent.match('\\$(.*)');
    const savedPrice = priceSave && priceSave.textContent.match('\\$(.*)');
    let percentage = 0;

    if (fullPrice !== null && savedPrice !== null) {
        percentage = Math.round(Number(savedPrice[1]) / Number(fullPrice[1]) * 100);
    } else {
        const priceTags = card.querySelectorAll('.price--was');
        const currentPriceEl = card.querySelector('.presentPrice');
        const currentPrice = currentPriceEl.ariaLabel;
        const nonMemberPrice = priceTags[1] && priceTags[1].textContent.match('\\$(.*)');
        const price = currentPrice.match(/\$([\d.]+)/)[1];

        if (priceTags[1] && price) {
            percentage = 100 - (Math.round(Number(price) / Number(nonMemberPrice[1]) * 100));
        }
    }

    if (strapLine.textContent.startsWith('Save') || strapLine.textContent === '') {
        strapLine.textContent = `${percentage}% Off`
    }
}
)
